<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects</title>
    <link rel="stylesheet" href="/Data/Styles/style.css">
    <link rel="stylesheet" href="/Data/Styles/fonts.css">
    <link rel="stylesheet" href="/Data/Styles/style.projects.css">
    <link rel="stylesheet" href="/Data/Styles/projects.css">
    <link rel="stylesheet" href="/Data/Styles/animation.css">
</head>

<body>
    <div class="navbar">
        <div id="navcontrol" class="navcontent">
            <h4>Projects</h4>
        </div>
        <a href="/">
            <div class="navexit" style="background-image: url('Data/Icons/action.exit.svg');"></div>
        </a>
        <a href="#" id="back" title="Back">
            <div class="navback" style="background-image: url('Data/Icons/action.back.svg');"></div>
        </a>
    </div>
    <div class="content" style="max-width: none;" id="normal">
        <div class="main-content">
            <h2 style="margin-top: 32px;">My Projects</h2>
            <div class="projects" id="projects-iceless"></div>
            <h2 style="margin-top: 32px;">PEIC Projects</h2>
            <div class="projects" id="projects-peic"></div>
            <h2 style="margin-top: 32px;">Recommended Projects</h2>
            <div class="projects" id="projects-recommended"></div>
            <h2 style="margin-top: 32px;">Wonderful Applications</h2>
            <div class="projects" id="projects-app"></div>
            <h2 style="margin-top: 32px;">Games I play</h2>
            <div class="projects" id="projects-games"></div>
        </div>
    </div>
    <div class="content" id="focus">
        <div id="focus-banner"></div>
        <div id="focus-content" class="main-content">
            <div class="focus-icon-name">
                <div id="focus-icon"></div>
                <h3 id="focus-name"></h3>
                <p id="focus-description"></p>
            </div>
            <a class="button" id="focus-url">GET</a>
            <div id="focus-textover"></div>
            <h2 style="margin-top: 32px;">Related Projects</h2>
            <div class="projects" id="focus-related"></div>
        </div>
    </div>
    <script type="module">
        import { ProjectsHTMLFromOwner } from '/Data/Scripts/projects.js';

        const urlParams = new URLSearchParams(window.location.search);

        function checkBackgroundImage(url, callback) {
            const img = new Image();
            img.onload = () => callback(true);
            img.onerror = () => callback(false);
            img.src = url;
        }

        if (urlParams.get("focus")) {
            document.getElementById("normal").style.display = "none";
            document.getElementById("focus").style.display = "block";

            const file = urlParams.get("focus").split(".",2)[0];
            const id = urlParams.get("focus").split(".",2)[1];

            /*if (urlParams.get("from")) {} else {
                const url = new URL(window.location.href);
                url.searchParams.set("from", "projects");
                window.history.pushState({}, "", url);
                location.reload();
            }*/

            fetch(`/Data/Projects/${file}.json`)
                .then(res => res.json())
                .then(data => {

                    data = data[id];

                    data.banner = data.banner || `/Data/Images/project.${id}.banner.png`;
                    data.icon = data.icon || `/Data/Icons/icon.${id}.svg`;

                    checkBackgroundImage(data.banner, (success) => {
                        if (!success) {
                            document.getElementById("focus-banner").style.height = "10vh";
                        }
                    });


                    document.getElementById("focus-banner").style.backgroundImage = `url('${data.banner}')`;
                    document.getElementById("focus-icon").style.backgroundImage = `url('${data.icon}')`;
                    document.getElementById("focus-name").textContent = data.name;
                    document.getElementById("focus-description").textContent = data.description;
                    document.getElementById("focus-url").href = data.url;
                    document.getElementById("focus-textover").innerHTML = `<p><strong>${data.title}: </strong>${data.subtitle}</p>`;
                    ProjectsHTMLFromOwner(file)
                        .then(html => document.getElementById('focus-related').innerHTML = html);
                });
        } else {
            ProjectsHTMLFromOwner('iceless')
                .then(html => document.getElementById('projects-iceless').innerHTML = html);
        
            ProjectsHTMLFromOwner('recommended')
                .then(html => document.getElementById('projects-recommended').innerHTML = html);

            ProjectsHTMLFromOwner('apps')
                .then(html => document.getElementById('projects-app').innerHTML = html);

            ProjectsHTMLFromOwner('peic')
                .then(html => document.getElementById('projects-peic').innerHTML = html);
            
            ProjectsHTMLFromOwner('games')
                .then(html => document.getElementById('projects-games').innerHTML = html);
        }
    </script>
    <script src="Data/Scripts/back.js"></script>
</body>

</html>