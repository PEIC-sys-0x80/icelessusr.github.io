# top指令

#資訊科技 #終端指令 #網路引用資料 #linux/unix指令  #linux
[參考資料](https://www.runoob.com/linux/linux-comm-top.html)

top指令是一個在 Linux 和其他類 Unix 系統上常用的系統即時監控工具。
它提供一個動態的交互式即時畫面，顯示系統整體性能資訊以及正在運行的處理程序相關資訊，類似於 Windows 中的「工作管理員」。
其使用的權限為所有使用者，不需要特權即可啟動。

top 不僅能監控 CPU、記憶體、磁碟 IO 等資源的使用情況，也能對進程進行排序、篩選和管理，因此是系統管理員與開發者排查效能問題、進行資源管理的重要工具之一。

---

## 語法

```
top [-d <秒數>] [-q] [-c] [-S] [-u <使用者>] [-i] [-n <次數>] [-H] [-b] [-p <PID>] [-s]
```

### 參數說明

* `-d <秒數>`: 指定 top 刷新的時間間隔（預設為3秒）。
* `-n <次數>`: 指定畫面更新幾次後自動退出，常用於自動化腳本中。
* `-p <處理程序ID(PID)>`: 只顯示特定 PID 的處理程序資訊，可指定多個 PID（以逗號分隔）。
* `-u <使用者>`: 只顯示特定使用者的處理程序。
* `-H`: 顯示每個處理程序的線程詳細資訊（Thread View）。
* `-i`: 隱藏閒置（idle）或無用的處理程序，便於專注於活躍進程。
* `-b`: 以非互動模式（batch mode）運行，輸出結果可重定向到檔案，適合記錄或自動化使用。
* `-c`: 顯示完整的命令列資訊，而不是程式名稱。
* `-S`: 顯示處理程序及其已終止子進程的累積 CPU 時間（累積模式）。
* `-q`: 以最高優先權執行 top（警告：可能影響系統效能）。
* `-s`: 啟用安全模式，限制使用者進行如殺死進程等交互操作（避免誤操作）。

---

## 顯示資訊

top 執行時會分為兩個主要部分：

### **總體系統資訊（Header）**

* `uptime`: 系統開機時間與執行時長（如 "up 3 days, 4:12"）
* `load average`: 最近 1、5、15 分鐘的平均負載指標（Load Average），衡量系統忙碌程度
* `tasks`: 當前程序數，包括運行中（running）、睡眠中（sleeping）、停止（stopped）與僵屍程序（zombie）
* `cpu(s)`: CPU 的使用分布（user/system/idle/iowait 等）
* `memory`: 顯示記憶體的總容量、使用量、可用空間與 buffer/cache 狀態
* `swap`: 虛擬記憶體（swap）的使用情況

### **處理程序清單（Processes）**

包含目前所有進程或符合篩選條件的進程，欄位如下：

* **PID**: 處理程序識別碼（Process ID）
* **USER**: 該程序所屬使用者
* **PR**: 優先等級（Priority）
* **NI**: nice 值（可用於調整優先順序）
* **VIRT**: 虛擬記憶體總用量
* **RES**: 實體記憶體使用量（不包括 swapped out 部分）
* **SHR**: 共享記憶體大小
* **S**: 程序狀態（如：R=Running, S=Sleeping, Z=Zombie, T=Stopped）
* **%CPU**: CPU 使用率
* **%MEM**: 記憶體使用率
* **TIME+**: 累積 CPU 使用時間
* **COMMAND**: 執行的命令或應用名稱（可配合 `-c` 顯示完整指令）

---

## 功能與互動操作（互動模式快捷鍵）

執行 top 時可透過下列按鍵進行操作：

| 按鍵  | 功能說明                 |
| --- | -------------------- |
| `h` | 顯示說明（help）           |
| `k` | 終止一個處理程序（輸入 PID）     |
| `r` | 重新調整程序的 nice 值       |
| `q` | 離開 top 程式            |
| `P` | 依照 CPU 使用率排序（預設）     |
| `M` | 依照記憶體使用率排序           |
| `T` | 依照執行時間排序             |
| `N` | 依照 PID 排序            |
| `u` | 篩選特定使用者的進程           |
| `1` | 切換是否顯示所有 CPU 核心的使用情況 |
| `f` | 新增/刪除顯示欄位            |
| `o` | 依據欄位排序（需配合欄位名稱）      |
| `z` | 切換彩色/單色顯示模式          |
| `b` | 切換高亮顯示目前選取行          |

---

## 進階用途與技巧

* **輸出 top 結果到檔案**:

  ```bash
  top -b -n 1 > top_snapshot.txt
  ```

* **僅顯示特定使用者的 top 視圖**:

  ```bash
  top -u nginx
  ```

* **持續監控特定進程的狀態（例如 PID 1234）**:

  ```bash
  top -p 1234
  ```

* **自動化監控腳本範例**:

  ```bash
  # 每10秒記錄一次 top，重複5次
  top -b -d 10 -n 5 >> monitor.log
  ```

* **檢查哪個進程導致高記憶體使用**:
  進入 top 後，按下 `M` 即可按照記憶體使用率排序。

* **切換多核心顯示（很實用於伺服器）**:
  按下 `1` 鍵可查看每個 CPU 核心的使用情況。

---

## 實例

顯示所有處理程序資訊：

```
# top
```

---

顯示完整命令列：

```
# top -c
```

---

以批次模式輸出資料：

```
# top -b
```

---

顯示處理程序與子進程累計 CPU 時間：

```
# top -S
```

---

更新兩次後自動退出：

```
# top -n 2
```

---

每 3 秒更新一次畫面：

```
# top -d 3
```

---

只顯示 PID 為 139 的程序：

```
# top -p 139
```

---

更新 10 次後自動結束：

```
# top -n 10
```

---

以安全模式執行（限制交互操作）：

```
# top -s
```
