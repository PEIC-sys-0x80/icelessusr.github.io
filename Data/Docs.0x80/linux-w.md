# w指令

#資訊科技 #終端指令 #網路引用資料 #linux/unix指令 #linux

[參考資料](https://www.runoob.com/linux/linux-comm-w.html)

Linux `w` 指令主要用於顯示目前登入系統的使用者資訊及其活動概況。這個指令是系統管理與監控的重要工具之一，能讓管理員快速了解誰正在系統上進行哪些操作，協助進行系統資源管理、故障排查或安全監控。

執行這個指令可得知目前登入系統的用戶有哪些人，他們登入的時間、來源IP、是否閒置、目前執行的程序等資訊。這些資訊可讓管理員判斷系統的使用情況與負載狀態。

單獨執行 `w` 指令會顯示所有使用者的資訊，也可以指定用戶名稱，只顯示該用戶的相關活動。

---

## 語法

```
w [-f] [-h] [-l] [-s] [-u] [-V] [<user_name>]
```

---

### 參數說明

* `-f`: 顯示或隱藏用戶從哪裡登入（FROM 欄位），若系統啟用 `CONFIG_W_SHOWFROM` 支援，預設會顯示此欄位。
* `-h`: 隱藏欄位標題列，使輸出更精簡。常用於與其他工具結合處理輸出資料時（如用 grep 或 awk 篩選資訊）。
* `-l`: 使用詳細格式（long format）顯示資訊，此為預設顯示格式。會列出登入時間、IDLE 時間、CPU 使用情況等詳細數據。
* `-s`: 使用簡潔格式（short format），只顯示重點欄位，省略 CPU 時間等細節，便於快速瀏覽。
* `-u`: 略過顯示使用者當前執行程序的 CPU 時間資訊（JCPU 與 PCPU 欄位），可加快指令執行速度。
* `-V`: 顯示 `w` 指令版本資訊，無其他輸出。
* `<user_name>`: 指定特定用戶名稱，僅列出該使用者的相關資訊。

---

## 顯示欄位說明

執行 `w` 指令時，常見輸出欄位包括：

* `USER`: 使用者帳號。
* `TTY`: 使用者登入的終端機（如 pts/0、tty7）。
* `FROM`: 使用者的登入來源（IP 或主機名）。
* `LOGIN@`: 使用者登入時間。
* `IDLE`: 使用者閒置多久沒動作。
* `JCPU`: 此終端上所有程序所耗費的 CPU 時間總和。
* `PCPU`: 當前執行的命令所耗費的 CPU 時間。
* `WHAT`: 使用者目前正在執行的命令。

---

## 實例

### 顯示目前所有使用者資訊

```
w
```

```
19:50:14 up 9:27, 4 users, load average: 0.31, 0.26, 0.18
USER   TTY   FROM       LOGIN@  IDLE  JCPU  PCPU WHAT
root   tty7   :0        Thu12  31:39m 10:10  0.60s gnome-session
root   pts/0  :0.0       17:09  2:18m 15.26s 0.15s bash
root   pts/1  192.168.1.17   18:51  1.00s 1.24s 0.14s -bash
root   pts/2  192.168.1.17   19:48  60.00s 0.05s 0.05s -bash
```

---

### 不顯示登入來源（FROM 欄位）

```
w -f
```

```
USER   TTY    LOGIN@  IDLE  JCPU  PCPU WHAT
root   tty7   Thu12  31:43m 10:10  0.60s gnome-session
root   pts/0   17:09  2:21m 15.26s 0.15s bash
```

---

### 使用簡潔模式

```
w -s
```

```
USER   TTY   FROM        IDLE WHAT
root   tty7   :0        31:43m gnome-session
root   pts/0  :0.0       2:22m bash
```

---

### 隱藏標題列

```
w -h
```

```
root   tty7   :0        Thu12  31:44m 10:10  0.60s gnome-session
root   pts/0  :0.0       17:09  2:23m 15.26s 0.15s bash
```

---

### 查詢特定用戶

```
w root
```

僅顯示 `root` 使用者的活動狀態。

---

## 進階用途與技巧

* **系統監控整合**：`w` 指令常與 `top`、`uptime`、`ps` 等系統監控工具搭配使用，以獲得全面的系統運作概況。
* **登入來源分析**：配合 `-f` 參數可快速掌握遠端登入來源，有助於安全分析與可疑活動偵測。
* **自動化腳本應用**：配合 `grep`、`awk` 等文字處理工具，可用於腳本中，自動過濾特定用戶或狀態，例如找出閒置超過一定時間的使用者。

  ```bash
  w -h | awk '$5 ~ /[0-9]+:[0-9]+m/ { print $1, $2, $5 }'
  ```

  可列出閒置時間超過 1 分鐘的使用者帳號與終端機。
* **資源分配調整依據**：當系統負載高時（可從 `load average` 判斷），可以搭配 `w` 檢視哪些使用者正在執行高耗能程序，進行資源優化或通知用戶。

---

`w` 指令是一個結合登入資訊與系統活動概況的強大工具，適用於系統管理員即時掌握系統使用狀況。透過靈活使用參數與結合其他工具，能顯著提升 Linux 系統管理效率與安全性。

---