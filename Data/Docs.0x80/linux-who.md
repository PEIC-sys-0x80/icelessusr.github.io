# who指令

#資訊科技 #終端指令 #網路引用資料 #linux/unix指令

[參考資料](https://www.runoob.com/linux/linux-comm-who.html)

Linux 的 `who` 指令用來顯示目前登入系統的使用者資訊。它是系統管理與監控中常用的工具之一，能夠協助系統管理員即時掌握系統資源的使用情況與連線來源，從而進行安全性監控、資源分配與使用者行為分析。

其顯示的資料通常包含使用者名稱（User ID）、使用的終端裝置（TTY）、登入時間、來源（例如遠端 IP 或主機名稱）、閒置時間（Idle）、使用者可否接收訊息的狀態（Message Status）等。

### 使用權限

所有使用者皆可使用此指令，無需額外權限。

---

## 語法

```
who [選項]
who [-H] [-i] [-m] [-q] [-s] [-w] [--help] [--version]
```

---

### 參數與選項

* `-H`, `--heading`: 顯示輸出欄位的標題列，便於識讀。
* `-i`, `-u`, `--idle`: 顯示使用者閒置時間。
  * 若使用者在最近 1 分鐘內有操作，顯示為冒號 `:`。
  * 若使用者已超過 24 小時無操作，顯示為 `old`。
  * 介於兩者之間則顯示分鐘數。
* `-m`: 僅顯示目前執行此指令的使用者（與 `who am i` 或 `who am I` 等效）。
* `-q`, `--count`: 精簡模式，僅列出使用者帳號與總登入人數。
* `-s`: 顯示基本資訊（預設模式），多數系統會忽略此參數，保留作為兼容性用途。
* `-w`, `-T`, `--mesg`, `--message`, `--writable`: 顯示終端機的可寫入狀態。
  * `+`: 表示該終端接受訊息。
  * `-`: 表示不接受訊息。
  * `?`: 無法判斷（可能無效或權限問題）。
* `--help`: 顯示說明文件。
* `--version`: 顯示指令版本資訊。

---

## 實例

### 顯示目前所有已登入的使用者

```
# who
root   tty7     2014-05-13 12:12 (:0)
root   pts/0    2014-05-14 17:09 (:0.0)
root   pts/1    2014-05-14 18:51 (192.168.1.17)
root   pts/2    2014-05-14 19:48 (192.168.1.17)
```

---

### 顯示標題列，方便理解每個欄位

```
# who -H
NAME   LINE     TIME       COMMENT
root   tty7     2014-05-13 12:12 (:0)
root   pts/0    2014-05-14 17:09 (:0.0)
...
```

---

### 顯示登入來源與 PID（進階登入資訊）

```
# who -l -H
NAME   LINE     TIME       IDLE     PID COMMENT
LOGIN  tty4     2014-05-13 12:11        852 id=4
...
```

---

### 顯示終端狀態（是否允許訊息）

```
# who -T -H
NAME   LINE     TIME       COMMENT
root   + tty7     2014-05-13 12:12 (:0)
root   - pts/1    2014-05-14 18:51 (192.168.1.17)
```

---

### 只顯示目前使用者

```
# who -m
root   pts/1    2014-05-14 18:51 (192.168.1.17)
```

---

### 以精簡格式列出登入使用者與總人數

```
# who -q
root root root root
# users=4
```

---

## 詳細用途說明

### 系統監控

透過 `who`，管理員可以檢視是否有非預期的使用者登入系統，進而針對可疑連線做出進一步追查（搭配 `last`、`w` 指令更有效）。

### 遠端連線確認

`who` 可顯示登入來源 IP 或主機名稱，有助於辨別哪些用戶是從遠端登入，確認 SSH 等服務的安全性。

### 停用閒置使用者

結合 `idle` 資訊與 shell script，系統管理員可自動登出長時間未操作的帳號，以節省系統資源或提升資安。

---

## 進階應用

### 配合 grep 篩選特定用戶

```
who | grep username
```

### 搭配 cut 顯示使用者清單

```
who | cut -d ' ' -f1 | sort | uniq
```

### 自動偵測閒置超過 1 小時的使用者

```
who -u | awk '$6 ~ /^[0-9]+$/ && $6 > 60 { print $1 " is idle for " $6 " minutes" }'
```

---

## 備註

* `who` 所顯示的資料主要來自 `/var/run/utmp` 檔案，這是一個用來記錄目前登入使用者的系統檔案。若此檔案損毀或遺失，`who` 可能無法正常運作。
* `who` 是 POSIX 標準的一部分，常見於 Linux、Unix、macOS 系統中，但細節顯示格式可能因系統而異。